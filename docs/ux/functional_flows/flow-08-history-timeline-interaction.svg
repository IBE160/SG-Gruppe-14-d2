<svg viewBox="0 0 1200 1400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'Inter', sans-serif; font-size: 24px; font-weight: 700; fill: #111827; }
      .subtitle { font-family: 'Inter', sans-serif; font-size: 14px; fill: #6B7280; }
      .box-title { font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600; fill: #1F2937; }
      .box-text { font-family: 'Inter', sans-serif; font-size: 11px; fill: #374151; }
      .code-text { font-family: 'Courier New', monospace; font-size: 10px; fill: #059669; }
      .label { font-family: 'Inter', sans-serif; font-size: 10px; font-weight: 500; fill: #6B7280; }
      .decision { font-family: 'Inter', sans-serif; font-size: 11px; font-weight: 600; fill: #7C3AED; }
      .action { font-family: 'Inter', sans-serif; font-size: 11px; fill: #2563EB; }
      .note { font-family: 'Inter', sans-serif; font-size: 10px; font-style: italic; fill: #DC2626; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#6B7280"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" class="title" text-anchor="middle">Flow 08: Historikk - Brukerinteraksjon</text>
  <text x="600" y="60" class="subtitle" text-anchor="middle">Kontraktakseptering med automatisk snapshot-lagring</text>

  <!-- Step 1: Session Start -->
  <rect x="50" y="90" width="1100" height="60" rx="6" fill="#F0FDF4" stroke="#10B981" stroke-width="2"/>
  <text x="600" y="115" class="box-title" text-anchor="middle">1. BRUKER STARTER SIMULERING</text>
  <text x="70" y="135" class="box-text">Dashboard vises med 3-tier budsjett (390 MNOK l√•st, 310 MNOK tilgjengelig)</text>

  <line x1="600" y1="150" x2="600" y2="180" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2: Baseline Creation -->
  <rect x="50" y="180" width="1100" height="120" rx="6" fill="#EFF6FF" stroke="#3B82F6" stroke-width="2"/>
  <text x="600" y="205" class="box-title" text-anchor="middle">2. SYSTEM OPPRETTER BASELINE SNAPSHOT (Versjon 0)</text>
  <text x="70" y="225" class="box-text">Backend API: POST /api/sessions ‚Üí Trigger baseline snapshot creation</text>
  <rect x="70" y="235" width="1060" height="55" rx="4" fill="#FFFFFF" stroke="#D1D5DB" stroke-width="1"/>
  <text x="90" y="255" class="code-text">INSERT INTO session_snapshots (version, label, budget_committed, budget_available)</text>
  <text x="90" y="270" class="code-text">VALUES (0, 'Baseline', 390000000, 310000000, ...)</text>

  <line x1="600" y1="300" x2="600" y2="330" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3: User Opens History (Optional) -->
  <rect x="50" y="330" width="1100" height="80" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="600" y="355" class="box-title" text-anchor="middle">3. BRUKER √ÖPNER HISTORIKK (Valgfritt)</text>
  <text x="70" y="380" class="action">Handling: Klikker "üïí Historikk" knapp ‚Üí Overlay panel √•pnes</text>
  <text x="70" y="395" class="box-text">Viser Versjon 0 (Baseline) med 12 l√•ste pakker, 390 MNOK committed, 310 MNOK tilgjengelig</text>

  <line x1="600" y1="410" x2="600" y2="440" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 4: Negotiation -->
  <rect x="50" y="440" width="1100" height="70" rx="6" fill="#F0FDF4" stroke="#10B981" stroke-width="2"/>
  <text x="600" y="465" class="box-title" text-anchor="middle">4. BRUKER FORHANDLER OG AKSEPTERER KONTRAKT</text>
  <text x="70" y="490" class="action">Chat Interface: Bruker forhandler med Bj√∏rn Eriksen (WBS 1.3.1)</text>
  <text x="70" y="505" class="box-text">AI tilbyr: "105 MNOK, 60 dager" ‚Üí Bruker klikker "‚úì Godta: 105 MNOK"</text>

  <line x1="600" y1="510" x2="600" y2="540" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 5: Snapshot Creation -->
  <rect x="50" y="540" width="1100" height="200" rx="6" fill="#EFF6FF" stroke="#3B82F6" stroke-width="2"/>
  <text x="600" y="565" class="box-title" text-anchor="middle">5. SYSTEM OPPRETTER SNAPSHOT (Versjon 1) - AUTOMATISK</text>
  <text x="70" y="590" class="box-text">Backend logikk ved POST /api/sessions/{id}/commitments:</text>

  <rect x="90" y="605" width="480" height="60" rx="4" fill="#FFFFFF" stroke="#D1D5DB" stroke-width="1"/>
  <text x="110" y="625" class="box-text" style="font-weight:600">5.1 Lagre commitment</text>
  <text x="130" y="645" class="code-text">INSERT INTO wbs_commitments (wbs_id, cost, duration)</text>

  <rect x="610" y="605" width="480" height="60" rx="4" fill="#FFFFFF" stroke="#D1D5DB" stroke-width="1"/>
  <text x="630" y="625" class="box-text" style="font-weight:600">5.2 Oppdater session</text>
  <text x="650" y="645" class="code-text">UPDATE game_sessions SET budget_used = 495</text>

  <rect x="90" y="680" width="1000" height="50" rx="4" fill="#F0FDF4" stroke="#10B981" stroke-width="1"/>
  <text x="110" y="700" class="box-text" style="font-weight:600">5.3 Opprett snapshot (Versjon 1)</text>
  <text x="130" y="720" class="code-text">INSERT INTO session_snapshots (version, label, budget_committed, contract_details, gantt_state)</text>

  <line x1="600" y1="740" x2="600" y2="770" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 6: UI Updates -->
  <rect x="50" y="770" width="1100" height="100" rx="6" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="600" y="795" class="box-title" text-anchor="middle">6. FRONTEND OPPDATERES (Real-time)</text>
  <text x="70" y="820" class="action">Dashboard oppdateres:</text>
  <text x="90" y="840" class="box-text">‚Ä¢ Budget: 390 ‚Üí 495 MNOK ‚Ä¢ Tilgjengelig: 310 ‚Üí 205 MNOK</text>
  <text x="90" y="855" class="box-text">‚Ä¢ WBS 1.3.1 merket som "üü¢ Fullf√∏rt"</text>

  <line x1="600" y1="870" x2="600" y2="900" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 7: View History -->
  <rect x="50" y="900" width="1100" height="140" rx="6" fill="#F3F4F6" stroke="#6B7280" stroke-width="2"/>
  <text x="600" y="925" class="box-title" text-anchor="middle">7. BRUKER SER OPPDATERT HISTORIKK</text>
  <text x="70" y="950" class="action">Hvis historikkpanel er √•pent ‚Üí automatisk oppdatering</text>

  <rect x="90" y="965" width="480" height="65" rx="4" fill="#FFFFFF" stroke="#D1D5DB" stroke-width="1"/>
  <text x="110" y="985" class="box-text" style="font-weight:600">Event Timeline (Venstre)</text>
  <text x="130" y="1005" class="box-text">‚¶ø Versjon 1: ‚úì WBS 1.3.1 (N√Ö)</text>
  <text x="130" y="1020" class="box-text" fill="#6B7280">‚óã Versjon 0: Baseline</text>

  <rect x="610" y="965" width="480" height="65" rx="4" fill="#FFFFFF" stroke="#D1D5DB" stroke-width="1"/>
  <text x="630" y="985" class="box-text" style="font-weight:600">Sammenligning (H√∏yre)</text>
  <text x="650" y="1005" class="box-text">F√∏r (V0): 390 MNOK | Etter (V1): 495 MNOK</text>
  <text x="650" y="1020" class="box-text" fill="#10B981">Endring: +105 MNOK, +60 dager</text>

  <line x1="600" y1="1040" x2="600" y2="1070" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Decision Diamond -->
  <polygon points="600,1070 700,1120 600,1170 500,1120" fill="#F3E8FF" stroke="#7C3AED" stroke-width="2"/>
  <text x="600" y="1125" class="decision" text-anchor="middle">Flere kontrakter?</text>

  <!-- Yes path (loop back) -->
  <line x1="700" y1="1120" x2="900" y2="1120" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="770" y="1110" class="label">JA</text>
  <line x1="900" y1="1120" x2="900" y2="440" stroke="#6B7280" stroke-width="2"/>
  <line x1="900" y1="440" x2="700" y2="440" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="910" y="780" class="label">Gjenta 4-7</text>

  <!-- No path -->
  <line x1="600" y1="1170" x2="600" y2="1210" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="620" y="1190" class="label">NEI (fullf√∏rt)</text>

  <!-- Step 8: Complete -->
  <rect x="200" y="1210" width="800" height="100" rx="6" fill="#F0FDF4" stroke="#10B981" stroke-width="2"/>
  <text x="600" y="1235" class="box-title" text-anchor="middle">8. FULLF√òRT - 3+ SNAPSHOTS LAGRET</text>
  <text x="220" y="1260" class="box-text">Historikk inneholder:</text>
  <text x="240" y="1280" class="box-text">‚Ä¢ Versjon 0: Baseline (390 MNOK) ‚Ä¢ Versjon 1: +WBS 1.3.1 (105 MNOK)</text>
  <text x="240" y="1295" class="box-text">‚Ä¢ Versjon 2: +WBS 1.3.2 (85 MNOK) ‚Ä¢ Versjon 3: +WBS 1.4.1 (88 MNOK)</text>

  <line x1="600" y1="1310" x2="600" y2="1340" stroke="#6B7280" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Final note -->
  <rect x="50" y="1340" width="1100" height="30" rx="4" fill="#FEF2F2" stroke="#DC2626" stroke-width="1"/>
  <text x="60" y="1360" class="note">‚ö†Ô∏è Viktig: Snapshots opprettes AUTOMATISK ved hver kontraktakseptering. Ingen manuell handling fra bruker.</text>
</svg>
