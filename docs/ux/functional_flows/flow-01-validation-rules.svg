<svg viewBox="0 0 1400 1800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'Inter', sans-serif; font-size: 28px; font-weight: 700; fill: #111827; }
      .subtitle { font-family: 'Inter', sans-serif; font-size: 14px; fill: #6B7280; }
      .heading { font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 600; fill: #111827; }
      .body-text { font-family: 'Inter', sans-serif; font-size: 13px; fill: #374151; }
      .small-text { font-family: 'Inter', sans-serif; font-size: 11px; fill: #6B7280; }
      .rule-box { fill: #FFFFFF; stroke: #3B82F6; stroke-width: 2; }
      .error-box { fill: #FEE2E2; stroke: #EF4444; stroke-width: 2; }
      .success-box { fill: #D1FAE5; stroke: #10B981; stroke-width: 2; }
      .warning-box { fill: #FEF3C7; stroke: #F59E0B; stroke-width: 2; }
      .process-box { fill: #EFF6FF; stroke: #3B82F6; stroke-width: 2; }
      .decision-diamond { fill: #FEF3C7; stroke: #F59E0B; stroke-width: 2; }
      .arrow { stroke: #6B7280; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-error { stroke: #EF4444; stroke-width: 2; fill: none; marker-end: url(#arrowhead-error); }
      .arrow-success { stroke: #10B981; stroke-width: 2; fill: none; marker-end: url(#arrowhead-success); }
      .code-text { font-family: 'Courier New', monospace; font-size: 11px; fill: #1F2937; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#6B7280" />
    </marker>
    <marker id="arrowhead-error" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#EF4444" />
    </marker>
    <marker id="arrowhead-success" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10B981" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" class="title" text-anchor="middle">Valideringsregler - Komplett Logikk</text>
  <text x="700" y="65" class="subtitle" text-anchor="middle">Budsjett- og Tidsfrister for Prosjektplan</text>

  <!-- Budget Model Reference -->
  <rect x="50" y="90" width="1300" height="100" rx="8" class="warning-box"/>
  <text x="700" y="115" class="heading" text-anchor="middle">üìä BUDSJETTMODELL (Referanse)</text>
  <text x="70" y="140" class="body-text">‚Ä¢ Total budsjett: 700 MNOK</text>
  <text x="70" y="160" class="body-text">‚Ä¢ L√•st (12 pakker): 390 MNOK (ikke-forhandlingsbare)</text>
  <text x="70" y="180" class="body-text">‚Ä¢ Tilgjengelig (3 pakker): 310 MNOK (forhandlingsbare)</text>
  <text x="700" y="140" class="body-text">‚Ä¢ Baseline estimat (3 pakker): 345 MNOK (105+60+180)</text>
  <text x="700" y="160" class="body-text">‚Ä¢ UNDERSKUDD FRA START: 35 MNOK</text>
  <text x="700" y="180" class="body-text">‚Ä¢ Tidsfrist: 15. mai 2026 (UFRAVIKELIG)</text>

  <!-- Start: User commits offer -->
  <rect x="550" y="220" width="300" height="60" rx="8" class="process-box"/>
  <text x="700" y="245" class="heading" text-anchor="middle">Bruker godtar tilbud</text>
  <text x="700" y="265" class="body-text" text-anchor="middle">Klikker "‚úì Godta tilbud"</text>

  <path d="M 700 280 L 700 320" class="arrow"/>

  <!-- Calculate Total Budget -->
  <rect x="550" y="320" width="300" height="80" rx="8" class="process-box"/>
  <text x="700" y="345" class="heading" text-anchor="middle">Beregn Total Budsjett</text>
  <text x="700" y="365" class="code-text" text-anchor="middle">total = locked + sum(committed)</text>
  <text x="700" y="380" class="code-text" text-anchor="middle">locked = 390 MNOK (konstant)</text>
  <text x="700" y="395" class="code-text" text-anchor="middle">committed = [WBS1, WBS2, WBS3]</text>

  <path d="M 700 400 L 700 440" class="arrow"/>

  <!-- Decision: Budget Check -->
  <polygon points="700,440 850,510 700,580 550,510" class="decision-diamond"/>
  <text x="700" y="505" class="heading" text-anchor="middle">total ‚â§ 700 MNOK?</text>
  <text x="700" y="525" class="small-text" text-anchor="middle">(Budsjettvalidering)</text>

  <!-- NO path - Over Budget -->
  <path d="M 850 510 L 1050 510" class="arrow-error"/>
  <text x="950" y="500" class="body-text" text-anchor="middle" fill="#EF4444">NEI</text>

  <rect x="1050" y="460" width="280" height="100" rx="8" class="error-box"/>
  <text x="1190" y="485" class="heading" text-anchor="middle" fill="#EF4444">‚ùå VALIDERING FEILET</text>
  <text x="1190" y="505" class="body-text" text-anchor="middle">Budsjettoverskridelse</text>
  <text x="1190" y="525" class="code-text" text-anchor="middle">error: "OVER_BUDGET"</text>
  <text x="1190" y="540" class="code-text" text-anchor="middle">excess: total - 700 MNOK</text>
  <text x="1190" y="555" class="small-text" text-anchor="middle">‚Üí Vis feilmodal</text>

  <!-- YES path - Budget OK, check time -->
  <path d="M 700 580 L 700 630" class="arrow-success"/>
  <text x="720" y="610" class="body-text" fill="#10B981">JA</text>

  <!-- Calculate Project End Date -->
  <rect x="550" y="630" width="300" height="100" rx="8" class="process-box"/>
  <text x="700" y="655" class="heading" text-anchor="middle">Beregn Prosjektslutt</text>
  <text x="700" y="675" class="code-text" text-anchor="middle">start = 15 Feb 2025</text>
  <text x="700" y="690" class="code-text" text-anchor="middle">end = start + max(finish_dates)</text>
  <text x="700" y="705" class="small-text" text-anchor="middle">Tar hensyn til kritisk sti</text>
  <text x="700" y="720" class="small-text" text-anchor="middle">(avhengigheter mellom pakker)</text>

  <path d="M 700 730 L 700 780" class="arrow"/>

  <!-- Decision: Time Check -->
  <polygon points="700,780 850,850 700,920 550,850" class="decision-diamond"/>
  <text x="700" y="840" class="heading" text-anchor="middle">end ‚â§ 15 Mai 2026?</text>
  <text x="700" y="860" class="small-text" text-anchor="middle">(Tidsfristvalidering)</text>

  <!-- NO path - Past Deadline -->
  <path d="M 850 850 L 1050 850" class="arrow-error"/>
  <text x="950" y="840" class="body-text" text-anchor="middle" fill="#EF4444">NEI</text>

  <rect x="1050" y="800" width="280" height="100" rx="8" class="error-box"/>
  <text x="1190" y="825" class="heading" text-anchor="middle" fill="#EF4444">‚ùå VALIDERING FEILET</text>
  <text x="1190" y="845" class="body-text" text-anchor="middle">Fristoverskridelse</text>
  <text x="1190" y="865" class="code-text" text-anchor="middle">error: "PAST_DEADLINE"</text>
  <text x="1190" y="880" class="code-text" text-anchor="middle">delay: end - 15 Mai 2026</text>
  <text x="1190" y="895" class="small-text" text-anchor="middle">‚Üí Vis feilmodal</text>

  <!-- YES path - All validations passed -->
  <path d="M 700 920 L 700 970" class="arrow-success"/>
  <text x="720" y="950" class="body-text" fill="#10B981">JA</text>

  <!-- Success -->
  <rect x="550" y="970" width="300" height="80" rx="8" class="success-box"/>
  <text x="700" y="995" class="heading" text-anchor="middle" fill="#10B981">‚úÖ VALIDERING BEST√ÖTT</text>
  <text x="700" y="1015" class="body-text" text-anchor="middle">Plan godkjent</text>
  <text x="700" y="1035" class="small-text" text-anchor="middle">‚Üí Vis suksessmodal</text>

  <!-- Left Side: Validation Rules Detail -->
  <rect x="50" y="1080" width="630" height="320" rx="8" class="rule-box"/>
  <text x="365" y="1110" class="heading" text-anchor="middle">üìã VALIDERINGSREGLER I DETALJ</text>

  <text x="70" y="1140" class="body-text" font-weight="600">1. BUDSJETTVALIDERING:</text>
  <text x="90" y="1160" class="code-text">IF (locked + sum(committed_costs)) > 700 MNOK:</text>
  <text x="110" y="1175" class="code-text">  REJECT with error "OVER_BUDGET"</text>
  <text x="110" y="1190" class="code-text">  excess_amount = total - 700</text>
  <text x="90" y="1210" class="small-text">Eksempel: 390 + (110 + 65 + 175) = 740 MNOK ‚Üí FEIL (40 MNOK over)</text>

  <text x="70" y="1240" class="body-text" font-weight="600">2. TIDSFRISTVALIDERING:</text>
  <text x="90" y="1260" class="code-text">critical_path = calculate_longest_path(wbs_items)</text>
  <text x="90" y="1275" class="code-text">project_end = START_DATE + critical_path_duration</text>
  <text x="90" y="1290" class="code-text">IF project_end > "2026-05-15":</text>
  <text x="110" y="1305" class="code-text">  REJECT with error "PAST_DEADLINE"</text>
  <text x="110" y="1320" class="code-text">  delay_days = project_end - deadline</text>
  <text x="90" y="1340" class="small-text">Eksempel: Sluttdato 25 Mai 2026 ‚Üí FEIL (10 dager forsinket)</text>

  <text x="70" y="1370" class="body-text" font-weight="600">3. UFULLSTENDIG PLAN:</text>
  <text x="90" y="1390" class="code-text">IF any(wbs_item.status == "pending"):</text>
  <text x="110" y="1405" class="code-text">  WARNING "Ikke alle pakker forhandlet"</text>

  <!-- Right Side: Error Messages -->
  <rect x="720" y="1080" width="630" height="320" rx="8" class="error-box"/>
  <text x="1035" y="1110" class="heading" text-anchor="middle" fill="#EF4444">‚ö†Ô∏è FEILMELDINGER</text>

  <text x="740" y="1140" class="body-text" font-weight="600">OVER_BUDGET:</text>
  <text x="760" y="1160" class="body-text">"Prosjektet overskrider budsjettet med {excess} MNOK."</text>
  <text x="760" y="1180" class="body-text">"Total: {total} MNOK / Maks: 700 MNOK"</text>
  <text x="760" y="1200" class="small-text">Handlinger: Reforhandle pakker for lavere pris</text>

  <text x="740" y="1230" class="body-text" font-weight="600">PAST_DEADLINE:</text>
  <text x="760" y="1250" class="body-text">"Prosjektet vil bli {delay} dager forsinket."</text>
  <text x="760" y="1270" class="body-text">"Forventet ferdig: {end_date} / Frist: 15 Mai 2026"</text>
  <text x="760" y="1290" class="small-text">Handlinger: Reforhandle for raskere levering</text>
  <text x="760" y="1310" class="small-text" fill="#EF4444">MERK: Eier kan IKKE forlenge frist!</text>

  <text x="740" y="1340" class="body-text" font-weight="600">INCOMPLETE_PLAN:</text>
  <text x="760" y="1360" class="body-text">"Du har {count} pakker som ikke er forhandlet."</text>
  <text x="760" y="1380" class="small-text">Advarsel, men plan kan lagres som utkast</text>

  <!-- Bottom: Implementation Notes -->
  <rect x="50" y="1430" width="1300" height="160" rx="8" class="warning-box"/>
  <text x="700" y="1460" class="heading" text-anchor="middle">üîß IMPLEMENTERINGSNOTATER FOR UTVIKLERE</text>

  <text x="70" y="1490" class="body-text" font-weight="600">Frontend Validering (UI feedback):</text>
  <text x="90" y="1510" class="code-text">‚Ä¢ Real-time budget display: Update on every commitment change</text>
  <text x="90" y="1525" class="code-text">‚Ä¢ Progress bars: Visual feedback (0-310 MNOK available, 390-700 MNOK total)</text>
  <text x="90" y="1540" class="code-text">‚Ä¢ Warning indicators: Show red if over budget, yellow if close to limit</text>

  <text x="70" y="1565" class="body-text" font-weight="600">Backend Validering (API):</text>
  <text x="90" y="1585" class="code-text">‚Ä¢ POST /api/validate-plan ‚Üí Returns {valid: boolean, errors: [], warnings: []}</text>

  <!-- Footer -->
  <rect x="50" y="1620" width="1300" height="140" rx="8" fill="#F9FAFB" stroke="#D1D5DB" stroke-width="1"/>
  <text x="700" y="1650" class="heading" text-anchor="middle">üí° VIKTIGE REGLER</text>
  <text x="70" y="1680" class="body-text">1. Budsjett: MAKSIMALT 700 MNOK totalt (390 l√•st + 310 tilgjengelig)</text>
  <text x="70" y="1700" class="body-text">2. Tid: UFRAVIKELIG frist 15. mai 2026 - Eier kan ALDRI forlenge</text>
  <text x="70" y="1720" class="body-text">3. Validering: Kj√∏res ALLTID f√∏r commit (frontend) og ved API-kall (backend)</text>
  <text x="70" y="1740" class="body-text">4. Kritisk sti: WBS 1.3.1 ‚Üí 1.3.2 ‚Üí 1.4.1 (sekvensiell avhengighet)</text>
</svg>
